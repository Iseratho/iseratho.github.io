<!DOCTYPE html>
<html lang="en"><head>
<script src="air23-transformer4ir-tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="air23-transformer4ir-tutorial_files/libs/quarto-html/tabby.min.js"></script>
<script src="air23-transformer4ir-tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="air23-transformer4ir-tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="air23-transformer4ir-tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="air23-transformer4ir-tutorial_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="air23-transformer4ir-tutorial_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="air23-transformer4ir-tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="air23-transformer4ir-tutorial_files/libs/quarto-contrib/jquery-3.6.3/jquery-3.6.3.min.js"></script>
<script src="air23-transformer4ir-tutorial_files/libs/quarto-contrib/code-fullscreen-1.0.0/code-fullscreen.js" defer="true"></script>
<link href="air23-transformer4ir-tutorial_files/libs/quarto-contrib/code-fullscreen-1.0.0/code-fullscreen.css" rel="stylesheet">
<link href="air23-transformer4ir-tutorial_files/libs/quarto-contrib/reveal-auto-agenda-0.0.3/reveal-auto-agenda.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Markus Reiter-Haas">
  <title>Transformers 4 IR</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="air23-transformer4ir-tutorial_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="air23-transformer4ir-tutorial_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="air23-transformer4ir-tutorial_files/libs/revealjs/dist/theme/quarto.css">
  <link href="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Transformers 4 IR</h1>
  <p class="subtitle">Advanced Information Retrieval(VU) (706.705)</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Markus Reiter-Haas <a href="https://orcid.org/0000-0001-9852-8206" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
</div>
<div class="quarto-title-author-email">
<a href="mailto:reiter-haas@tugraz.at">reiter-haas@tugraz.at</a>
</div>
        <p class="quarto-title-affiliation">
            ISDS, TU Graz
          </p>
    </div>
</div>

  <p class="date">2023-11-28, 2023-12-05</p>
</section>
<section>

<section id="about-todays-class" class="slide level2">
<h2>About today’s class</h2>
<ul>
<li>Learn about Transformers and its uses for IR</li>
<li>Hands-on step-by-step tutorial on how to performan an IR experiment</li>
<li>Should provide guidance for practicals</li>
<li>We will focus on BERT (likely the most popular), but knowledges translates to other Transformers as well</li>
<li>Based on <a href="https://arxiv.org/abs/2010.06467">BERT 4 Text Ranking</a></li>
<li>Showcase <a href="https://www.sbert.net/index.html">sBERT</a> and <a href="https://maartengr.github.io/BERTopic/api/bertopic.html">BERTopic</a> libraries (build upon <a href="https://huggingface.co/">HuggingFace</a> and <a href="https://pytorch.org/">PyTorch</a>)</li>
<li>Illustrations will link to <a href="https://jalammar.github.io/">Jay Alammer Blog</a> and <a href="https://www.sbert.net/index.html">sBERT Docs</a></li>
<li>Resources (e.g., associated papers) are provided inline as link.</li>
</ul>
</section>
<section id="learning-goals" class="slide level2">
<h2>Learning goals</h2>
<p>At the end of this unit, you will be able to:</p>
<ul>
<li>setup and perform an IR experiment including preprocessing and analysis</li>
<li>apply transformers to solve IR problems, such as text (re-)ranking</li>
<li>understand how transformers can be used to improve text retrieval</li>
<li>list well-known architectures and their use cases</li>
<li>develop suitable training procedures for IR tasks</li>
<li>know best practices and pitfalls in IR evaluation</li>
</ul>
</section>
<section id="recap-neural-retrieval" class="slide level2">
<h2>Recap Neural Retrieval</h2>
<ul>
<li>Neural networks applied to IR tasks.</li>
<li>For instance, estimate relevance.</li>
<li>Often heavily relies on embeddings.</li>
</ul>
</section>
<section id="neural-network-components" class="slide level2">
<h2>Neural Network Components</h2>
<ul>
<li>Architecture</li>
<li>Model (+ weights)</li>
<li>Loss</li>
<li>Optimizer</li>
<li>Optional Scheduler</li>
</ul>
</section></section>
<section>
<section id="transformer-by-examples" class="title-slide slide level1 agenda-slide center">
<h1>Transformer by Examples</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section id="pretrained-transformer" class="slide level2">
<h2>Pretrained Transformer</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">%</span>pip install <span class="op">-</span>Uq sentence<span class="op">-</span>transformers faiss<span class="op">-</span>cpu accelerate hdbscan bertopic evaluate kaleido datasets<span class="op">&gt;=</span><span class="fl">2.11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer, AutoModel, AutoModelForSequenceClassification</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">import</span> torch</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>examples <span class="op">=</span> [<span class="st">"I love you."</span>, <span class="st">"I hate you."</span>, <span class="st">"I see you."</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>trans_tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"cardiffnlp/twitter-roberta-base-sentiment"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>trans_model <span class="op">=</span> AutoModelForSequenceClassification.from_pretrained(<span class="st">"cardiffnlp/twitter-roberta-base-sentiment"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>trans_model(<span class="op">**</span>trans_tokenizer(examples, return_tensors<span class="op">=</span><span class="st">"pt"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d3e3102a1aed424ab675eb0bbda41c54","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1b0df57846304a6a888ebce698154b88","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f50d441181134c17959dd7dfba71f329","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7447c2898a834ff29bca2b89147be587","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"04c8da7b4c8748229a1076514846cb70","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>SequenceClassifierOutput(loss=None, logits=tensor([[-2.0218, -0.3980,  3.0771],
        [ 2.8151, -0.5906, -2.0748],
        [-0.1817,  0.9144, -0.3362]], grad_fn=&lt;AddmmBackward0&gt;), hidden_states=None, attentions=None)</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Alternatively load fixed pipeline</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>pipeline(<span class="st">"text-classification"</span>, model<span class="op">=</span><span class="st">"cardiffnlp/twitter-roberta-base-sentiment"</span>)(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>[{'label': 'LABEL_2', 'score': 0.9642633199691772},
 {'label': 'LABEL_0', 'score': 0.9608864784240723},
 {'label': 'LABEL_1', 'score': 0.6171057820320129}]</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>trans_tokenizer(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>{'input_ids': [[0, 100, 657, 47, 4, 2], [0, 100, 4157, 47, 4, 2], [0, 100, 192, 47, 4, 2]], 'attention_mask': [[1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1]]}</code></pre>
</div>
</div>
</div>
</section>
<section id="consider-the-embeddings-only" class="slide level2">
<h2>Consider the embeddings only</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>trans_model_wo_head <span class="op">=</span> trans_model.roberta  <span class="co"># No trans_model.classifier</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>res <span class="op">=</span> trans_model_wo_head(<span class="op">**</span>trans_tokenizer(examples, return_tensors<span class="op">=</span><span class="st">"pt"</span>)).last_hidden_state</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>np.array(trans_tokenizer(examples)[<span class="st">"input_ids"</span>])[:, <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>array([47, 47, 47])</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>res[:, <span class="dv">3</span>, :<span class="dv">8</span>]  <span class="co"># Completely different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>tensor([[ 0.2013,  1.1354, -0.4476, -0.4864,  1.4788,  0.8109,  0.3484, -0.5514],
        [-0.2421,  0.2407,  0.1613, -0.7413,  1.2675, -1.1970,  0.9893, -0.3319],
        [-0.4125, -0.4480,  0.3700, -0.6575,  0.8338, -0.1514,  0.4230, -0.3423]],
       grad_fn=&lt;SliceBackward0&gt;)</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>res[<span class="dv">0</span>].mean(<span class="dv">0</span>).shape  <span class="co"># simple pooling of first example</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>torch.Size([768])</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>id_map <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2"></a>    <span class="dv">0</span>: <span class="st">"love"</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="dv">1</span>: <span class="st">"hate"</span>,</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="dv">2</span>: <span class="st">"see "</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>}</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="kw">def</span> pairwise_cosine_sim(res):</span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="im">import</span> torch</span>
<span id="cb16-8"><a href="#cb16-8"></a>    <span class="im">from</span> torch <span class="im">import</span> nn</span>
<span id="cb16-9"><a href="#cb16-9"></a>    cos_sim <span class="op">=</span> torch.nn.CosineSimilarity(dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb16-11"><a href="#cb16-11"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb16-12"><a href="#cb16-12"></a>            <span class="cf">if</span> i <span class="op">==</span> j:  <span class="co"># always 1</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>                <span class="cf">continue</span></span>
<span id="cb16-14"><a href="#cb16-14"></a>            <span class="cf">if</span> i <span class="op">&gt;</span> j:  <span class="co"># symmetric relation</span></span>
<span id="cb16-15"><a href="#cb16-15"></a>                <span class="cf">continue</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>            c <span class="op">=</span> cos_sim(res[i].mean(<span class="dv">0</span>), res[j].mean(<span class="dv">0</span>))</span>
<span id="cb16-17"><a href="#cb16-17"></a>            <span class="bu">print</span>(id_map[i], id_map[j], c)</span>
<span id="cb16-18"><a href="#cb16-18"></a>            </span>
<span id="cb16-19"><a href="#cb16-19"></a>pairwise_cosine_sim(res)  <span class="co"># While all show similarity, we observe some expected differences</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>love hate tensor(0.2491, grad_fn=&lt;SumBackward1&gt;)
love see  tensor(0.5104, grad_fn=&lt;SumBackward1&gt;)
hate see  tensor(0.6279, grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
</div>
</section>
<section id="comparison-to-word2vec" class="slide level2">
<h2>Comparison to Word2Vec</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Load tokenizer and model but take only Word2Vec layer</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>REPO_NAME <span class="op">=</span> <span class="st">"vocab-transformers/distilbert-word2vec_256k-MLM_250k"</span></span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>w2v_tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(REPO_NAME)</span>
<span id="cb18-5"><a href="#cb18-5"></a>w2v_model <span class="op">=</span> AutoModel.from_pretrained(REPO_NAME)._modules[<span class="st">"embeddings"</span>].word_embeddings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ac8e6a0e6bec450ab972b4d819bae4c6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2b6782749ca74565a986b67c292c4ec4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"87239d945d114baebf92cba5cf0d6e57","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0c67ff9632914688886851b43b759687","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"35abc9a27dfc4745a33b4fdd43a0d2d0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>t <span class="op">=</span> torch.tensor(w2v_tokenizer(examples).input_ids)</span>
<span id="cb19-2"><a href="#cb19-2"></a>t, w2v_tokenizer.convert_ids_to_tokens(t[:, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>(tensor([[    1,    75, 26564, 25776,    42,     2],
         [    1,    75, 33141, 25776,    42,     2],
         [    1,    75, 26213, 25776,    42,     2]]),
 ['you', 'you', 'you'])</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>res2 <span class="op">=</span> w2v_model(t)</span>
<span id="cb21-2"><a href="#cb21-2"></a>res2[:, <span class="dv">3</span>, :<span class="dv">8</span>]  <span class="co"># all the same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>tensor([[-0.0596, -0.0382, -0.0150, -0.0114, -0.0367, -0.0157, -0.0453,  0.0235],
        [-0.0596, -0.0382, -0.0150, -0.0114, -0.0367, -0.0157, -0.0453,  0.0235],
        [-0.0596, -0.0382, -0.0150, -0.0114, -0.0367, -0.0157, -0.0453,  0.0235]],
       grad_fn=&lt;SliceBackward0&gt;)</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>pairwise_cosine_sim(res2)  <span class="co"># All sentences are seen as almost identical.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>love hate tensor(0.9487, grad_fn=&lt;SumBackward1&gt;)
love see  tensor(0.9415, grad_fn=&lt;SumBackward1&gt;)
hate see  tensor(0.9334, grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
</div>
</section>
<section id="application-examples-of-transformers" class="slide level2">
<h2>Application Examples of Transformers</h2>
<p>So far we have seen text classification and embeddings (i.e., base encoders without head, for instance as textual similarity).</p>
<h3 id="text-generation-gpt">Text Generation (GPT)</h3>
<p>The well known example: ChatGPT got lots of attention from a broader audience.<br>
Also due to, statements about “sentient AI”.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>pipeline(<span class="st">"text-generation"</span>, model<span class="op">=</span><span class="st">"gpt2"</span>)(</span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="st">"My name is Mariama, my favorite"</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9b1fbda8dbc84602b372cd73de19c62e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b6eac1cdcc01483f88e9b468cec7a5f7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"dc76ed0138d74daa8f49ede3b5b61c8d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3123da2479e94913a6dae6b81ea30449","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"82cb2319c4fd4278be3957ab2169036e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6fa50523f5a64e21b7330239a7b17277","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'generated_text': 'My name is Mariama, my favorite anime about me."\n\nHer husband was a classmate of Natsuki\'s, and the two were "fascinating and adorable friends." He told Natsuki that he had never met his own husband before:'}]</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<center>
<embed src="https://iseratho.github.io/teaching/ChatGPT_vs_Google_Search.pdf#toolbar=0&amp;navpanes=0&amp;scrollbar=0" type="application/pdf" width="550px" height="850px">
</center>
</section>
<section id="mask-filling" class="slide level2">
<h2>Mask Filling</h2>
<p>This is often used for pretrainig of models, e.g., in BERT.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>pipeline(<span class="st">"fill-mask"</span>, <span class="st">"bert-base-uncased"</span>)(</span>
<span id="cb27-2"><a href="#cb27-2"></a>    <span class="st">"Paris is the [MASK] of France."</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5af967a574104e649720cda67c6a2424","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"111f82dd202549b1a36ab8955f30d1f2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fed344546e9b45b3a29c41abf285b68a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"73736bdc62ea4bd185056893f7ef06b0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"05fdb9a0451a43ff9d2ebd9fa3df40da","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'score': 0.9969370365142822,
  'token': 3007,
  'token_str': 'capital',
  'sequence': 'paris is the capital of france.'},
 {'score': 0.0005914860521443188,
  'token': 2540,
  'token_str': 'heart',
  'sequence': 'paris is the heart of france.'},
 {'score': 0.0004378748417366296,
  'token': 2415,
  'token_str': 'center',
  'sequence': 'paris is the center of france.'},
 {'score': 0.0003378352848812938,
  'token': 2803,
  'token_str': 'centre',
  'sequence': 'paris is the centre of france.'},
 {'score': 0.0002699583419598639,
  'token': 2103,
  'token_str': 'city',
  'sequence': 'paris is the city of france.'}]</code></pre>
</div>
</div>
</div>
</section>
<section id="token-classification" class="slide level2">
<h2>Token Classification</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>pipeline(<span class="st">"token-classification"</span>, model<span class="op">=</span><span class="st">"dslim/bert-base-NER"</span>)(</span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="st">"My name is Sarah and I live in London"</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9af2668a73d946e79f17da0562ed1c11","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"77d00e6c8d64428794d1912d1e9702b2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"497c49aa192f4460aaa0aa7e346460b1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4174e2ee0bbe4f32a1318d1beef093c7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f343dd5bc70e4bb6b4d513fe0e4b0ddc","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6986bc6864604c38ad7c7f82a20fdff0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'entity': 'B-PER',
  'score': 0.99854773,
  'index': 4,
  'word': 'Sarah',
  'start': 11,
  'end': 16},
 {'entity': 'B-LOC',
  'score': 0.9996215,
  'index': 9,
  'word': 'London',
  'start': 31,
  'end': 37}]</code></pre>
</div>
</div>
</div>
</section>
<section id="zero-shot-classification" class="slide level2">
<h2>Zero Shot Classification</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>classifier <span class="op">=</span> pipeline(<span class="st">"zero-shot-classification"</span>,</span>
<span id="cb31-2"><a href="#cb31-2"></a>                      model<span class="op">=</span><span class="st">"facebook/bart-large-mnli"</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>sequence_to_classify <span class="op">=</span> <span class="st">"one day I will see the world"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f9a488d75a2148e6a15f6a2829c5bf2c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"74e14585fb7948799e27fc5e1f311600","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c5bc57df297447218676ad428723e07b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"17454878bdbf49f88c36af58348f0174","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6327c40396de49198f58a8936f4fac79","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"aedd06673423474897aefa2db9d9a091","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>candidate_labels <span class="op">=</span> [<span class="st">'travel'</span>, <span class="st">'cooking'</span>, <span class="st">'dancing'</span>]</span>
<span id="cb32-2"><a href="#cb32-2"></a>classifier(sequence_to_classify, candidate_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>{'sequence': 'one day I will see the world',
 'labels': ['travel', 'dancing', 'cooking'],
 'scores': [0.9938650727272034, 0.003273805370554328, 0.0028610355220735073]}</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>candidate_labels <span class="op">=</span> [<span class="st">'travel'</span>, <span class="st">'cooking'</span>, <span class="st">'dancing'</span>, <span class="st">'exploration'</span>]</span>
<span id="cb34-2"><a href="#cb34-2"></a>classifier(sequence_to_classify, candidate_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>{'sequence': 'one day I will see the world',
 'labels': ['travel', 'exploration', 'dancing', 'cooking'],
 'scores': [0.7957563400268555,
  0.199331596493721,
  0.0026212322991341352,
  0.0022907406091690063]}</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>candidate_labels <span class="op">=</span> [<span class="st">'travel'</span>, <span class="st">'cooking'</span>, <span class="st">'dancing'</span>, <span class="st">'exploration'</span>]</span>
<span id="cb36-2"><a href="#cb36-2"></a>classifier(sequence_to_classify, candidate_labels, multi_label<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>{'sequence': 'one day I will see the world',
 'labels': ['travel', 'exploration', 'dancing', 'cooking'],
 'scores': [0.994511067867279,
  0.9383884072303772,
  0.005706198047846556,
  0.0018192853312939405]}</code></pre>
</div>
</div>
</div>
</section>
<section id="question-answering-extractive" class="slide level2">
<h2>Question Answering (extractive)</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>pipeline(<span class="st">"question-answering"</span>, model<span class="op">=</span><span class="st">"deepset/minilm-uncased-squad2"</span>)(</span>
<span id="cb38-2"><a href="#cb38-2"></a>    question<span class="op">=</span><span class="st">"Where do I live?"</span>,</span>
<span id="cb38-3"><a href="#cb38-3"></a>    context<span class="op">=</span><span class="st">"My name is Sarah and I live in London"</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e32092693c7047dc9e2132c478d9939f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5cc5e5c0ce2143ecb403ec54d2242449","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fcedd9be0c0a4fef88143918a5b5f39b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6cea0b03b3334719a02f3e395da0f123","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8904dcc25c88424a9832b4f939d59808","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>{'score': 0.9948917031288147, 'start': 31, 'end': 37, 'answer': 'London'}</code></pre>
</div>
</div>
</div>
</section>
<section id="history-of-transformers" class="slide level2">
<h2>History of Transformers</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Word2Vec 2013 → Attention 2014 → Transformers 2017<br>
<br><br>
Gradual Improvements:</p>
<ul>
<li>BERT (2018), BART (2019), GPT (1-3, 2018-2020)</li>
<li>Vision Transformers (2020)</li>
<li>Failed Attempts at LLMs (Galactica 2022, 3 days)</li>
</ul>
<p>Until:</p>
<ul>
<li><strong>ChatGPT</strong> released on November 30, 2022</li>
<li>Many from Industry since (Bard, Llama)</li>
<li>Towards Open-Source (Alpaca, Llama2, Falcon)</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://huggingface.co/blog/assets/33_large_language_models/01_model_size.jpg"></p>
<figcaption>Fig.: Models Size over Time</figcaption>
</figure>
</div>
</div>
</div>
</section></section>
<section>
<section id="conducting-an-ir-experiment" class="title-slide slide level1 agenda-slide center">
<h1>Conducting an IR experiment</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section id="typical-pipeline" class="slide level2">
<h2>Typical pipeline:</h2>
<ul>
<li><strong>Loading and processing a dataset</strong></li>
<li>Implement algorithms and baselines.</li>
<li>Running algorithms (simulating real-world application).</li>
<li>Evaluating the results (beyond loss).</li>
<li>Analysing the results.</li>
<li>Optional: optimize and put into production.</li>
</ul>
</section>
<section id="setup-ir-dataset" class="slide level2">
<h2>Setup (IR dataset)</h2>
<p>This notebook was developed on Kaggle. As Kaggle provides a basic stable environment, no tinkering is required (i.e., setup Jupyter, Conda/Pip, Python Environment).</p>
<p>Let’s first setup the required libraries (usually iteratively updated).</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset, DatasetDict</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="im">import</span> sentence_transformers</span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="im">import</span> sentence_transformers.cross_encoder.evaluation</span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer, CrossEncoder, InputExample  <span class="co"># High-level sentence encoders.</span></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="im">import</span> sentence_transformers.models <span class="im">as</span> models</span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="im">import</span> sentence_transformers.losses <span class="im">as</span> losses</span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="im">import</span> torch</span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> Dataset, DataLoader</span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm  <span class="co"># Enables progress bars</span></span>
<span id="cb40-10"><a href="#cb40-10"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb40-11"><a href="#cb40-11"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb40-12"><a href="#cb40-12"></a></span>
<span id="cb40-13"><a href="#cb40-13"></a><span class="im">import</span> os</span>
<span id="cb40-14"><a href="#cb40-14"></a>os.environ[<span class="st">"TOKENIZERS_PARALLELISM"</span>] <span class="op">=</span> <span class="st">"false"</span></span>
<span id="cb40-15"><a href="#cb40-15"></a></span>
<span id="cb40-16"><a href="#cb40-16"></a>QUICK_RUN <span class="op">=</span> <span class="va">False</span>  <span class="co"># Config setting to switch between foreground (subset) and background (full-dataset) running</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choosing-finding-the-dataset." class="slide level2">
<h2>Choosing (finding) the dataset.</h2>
<p>We will perform document retrieval and ranking. Hence, we choose a benchmark dataset in this domain on Scientific documents.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># https://aclanthology.org/2020.acl-main.207/</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="co"># https://arxiv.org/abs/2104.08663</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>queries <span class="op">=</span> load_dataset(<span class="st">"BeIR/scidocs"</span>, <span class="st">"queries"</span>, split<span class="op">=</span><span class="st">"queries"</span>)</span>
<span id="cb41-4"><a href="#cb41-4"></a>docs <span class="op">=</span> load_dataset(<span class="st">"BeIR/scidocs"</span>, <span class="st">"corpus"</span>, split<span class="op">=</span><span class="st">"corpus"</span>)</span>
<span id="cb41-5"><a href="#cb41-5"></a>qrels <span class="op">=</span> load_dataset(<span class="st">"BeIR/scidocs-qrels"</span>, delimiter<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>, split<span class="op">=</span><span class="st">"test"</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="bu">len</span>(queries), <span class="bu">len</span>(docs), <span class="bu">len</span>(qrels), <span class="bu">len</span>(<span class="bu">set</span>(qrels[<span class="st">"query-id"</span>])), <span class="bu">len</span>(<span class="bu">set</span>(qrels[<span class="st">"corpus-id"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1a97239f5b4842379563c9865eb97f40","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"eb705e1b556f414fa7929ee8a5374c87","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"17a0f8438be4408b8cc67e6a4532e015","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6666e587d53c41e3a214a395040f92a7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8a5e54c841804cb783b2973875669c3d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e82b208de61148b3a667574b92013e1e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bc03d1cdc87047f7bc20579ac76276a9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8ccfa037afda4f4582b00ca59b934141","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cce9b8add3f34624b84e60128d5a6b43","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"87da3104d2864c1e8fb075a6bcbebcc7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"41468b8e94634e36a28d06ac372e2ab2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>(1000, 25657, 29928, 1000, 25657)</code></pre>
</div>
</div>
</div>
</section>
<section id="structure" class="slide level2">
<h2>Structure</h2>
<p>In IR, we have a query, a collection of documents and a assignment of relevancy between (some) queries and documents. This can be seen by the way the dataset is structured.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>queries, docs, qrels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>(Dataset({
     features: ['_id', 'title', 'text'],
     num_rows: 1000
 }),
 Dataset({
     features: ['_id', 'title', 'text'],
     num_rows: 25657
 }),
 Dataset({
     features: ['query-id', 'corpus-id', 'score'],
     num_rows: 29928
 }))</code></pre>
</div>
</div>
</div>
<h3 id="preprocessing.-sparsity.-cold-start-problem.-keep-in-mind-the-tasks.">Preprocessing. Sparsity. Cold-start problem. Keep in mind the tasks.</h3>
<p>Our dataset already has a natural representation. We could still perform filtering. We must ensure that no information is lost.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># For demonstration purposes only</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="cf">if</span> QUICK_RUN:</span>
<span id="cb45-3"><a href="#cb45-3"></a>    queries <span class="op">=</span> queries.select(<span class="bu">range</span>(<span class="dv">100</span>))</span>
<span id="cb45-4"><a href="#cb45-4"></a>    docs <span class="op">=</span> docs.select(<span class="bu">range</span>(<span class="dv">2500</span>))</span>
<span id="cb45-5"><a href="#cb45-5"></a>    qrels <span class="op">=</span> qrels.<span class="bu">filter</span>(<span class="kw">lambda</span> x: x[<span class="st">"query-id"</span>] <span class="kw">in</span> queries[<span class="st">"_id"</span>] <span class="kw">and</span> x[<span class="st">"corpus-id"</span>] <span class="kw">in</span> docs[<span class="st">"_id"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
</section>
<section id="train-validation-test-set." class="slide level2">
<h2>Train, validation, test set.</h2>
<p>This step is very <strong>important</strong>.</p>
<ul>
<li><strong>Train</strong> for algorithm parameter estimation.</li>
<li><strong>Valid</strong>-ation (also called <strong>dev</strong>-elopment) for finding a good model (e.g., hyperparameter optimization, cross-validation).</li>
<li><strong>Test</strong> (also called <strong>eval</strong>-uation) only used for evaluation at the very end.</li>
</ul>
<p>Sometimes datasets have predefined splits that can be used.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># 90% train, 10% test + validation</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>train_testvalid <span class="op">=</span> qrels.train_test_split(test_size<span class="op">=</span><span class="fl">0.1</span>, seed<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="co"># Split the 10% test + valid in half test, half valid</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>test_valid <span class="op">=</span> train_testvalid[<span class="st">'test'</span>].train_test_split(test_size<span class="op">=</span><span class="fl">0.5</span>, seed<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="co"># gather everyone if you want to have a single DatasetDict</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>train_test_valid_dataset <span class="op">=</span> DatasetDict({</span>
<span id="cb46-7"><a href="#cb46-7"></a>    <span class="st">'train'</span>: train_testvalid[<span class="st">'train'</span>],</span>
<span id="cb46-8"><a href="#cb46-8"></a>    <span class="st">'test'</span>: test_valid[<span class="st">'test'</span>],</span>
<span id="cb46-9"><a href="#cb46-9"></a>    <span class="st">'valid'</span>: test_valid[<span class="st">'train'</span>]})</span>
<span id="cb46-10"><a href="#cb46-10"></a>train_test_valid_dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>DatasetDict({
    train: Dataset({
        features: ['query-id', 'corpus-id', 'score'],
        num_rows: 26935
    })
    test: Dataset({
        features: ['query-id', 'corpus-id', 'score'],
        num_rows: 1497
    })
    valid: Dataset({
        features: ['query-id', 'corpus-id', 'score'],
        num_rows: 1496
    })
})</code></pre>
</div>
</div>
</div>
</section>
<section id="splitting-methods" class="slide level2">
<h2>Splitting methods</h2>
<ul>
<li>depend on the task</li>
<li>random sometimes not feasible -&gt; data leakage</li>
</ul>
<p>Common alternative splitting options:</p>
<ul>
<li>time-based</li>
<li>session-based</li>
<li>user-based</li>
</ul>
</section></section>
<section>
<section id="analysis---bertopic-showcase" class="title-slide slide level1 agenda-slide center">
<h1>Analysis - BERTopic Showcase</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section class="slide level2">

<p>First, we will analyze the data.<br>
For the start let’s just look at some example relevance assignments and their associated content.</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">def</span> get_triple_for_example(example):</span>
<span id="cb48-2"><a href="#cb48-2"></a>    q <span class="op">=</span> queries[queries[<span class="st">"_id"</span>].index(example[<span class="st">"query-id"</span>])][<span class="st">"text"</span>]</span>
<span id="cb48-3"><a href="#cb48-3"></a>    d <span class="op">=</span> docs[docs[<span class="st">"_id"</span>].index(example[<span class="st">"corpus-id"</span>])][<span class="st">"title"</span>]</span>
<span id="cb48-4"><a href="#cb48-4"></a>    r <span class="op">=</span> example[<span class="st">"score"</span>]</span>
<span id="cb48-5"><a href="#cb48-5"></a>    <span class="cf">return</span> q, d, r</span>
<span id="cb48-6"><a href="#cb48-6"></a></span>
<span id="cb48-7"><a href="#cb48-7"></a>ex0 <span class="op">=</span> get_triple_for_example(train_test_valid_dataset[<span class="st">"test"</span>][<span class="dv">0</span>])</span>
<span id="cb48-8"><a href="#cb48-8"></a>ex1 <span class="op">=</span> get_triple_for_example(train_test_valid_dataset[<span class="st">"test"</span>][<span class="dv">1</span>])</span>
<span id="cb48-9"><a href="#cb48-9"></a>ex0, ex1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>(('Provable data possession at untrusted stores',
  'StreamOp: An Innovative Middleware for Supporting Data Management and Query Functionalities over Sensor Network Streams Efficiently',
  0),
 ('Rumor Detection and Classification for Twitter Data',
  'Thumbs Up or Thumbs Down? Semantic Orientation Applied to Unsupervised Classification of Reviews',
  1))</code></pre>
</div>
</div>
</div>
</section>
<section id="label-distribution" class="slide level2">
<h2>Label Distribution</h2>
<p>An important aspect to consider.<br>
What would be an implication of an imbalanced dataset?</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a><span class="im">import</span> evaluate</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="co"># Here we use evaluate library</span></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="co"># Alternatively, implement on your own with scipy.stats and collections.Counter</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>label_dist <span class="op">=</span> evaluate.load(<span class="st">"evaluate-measurement/label_distribution"</span>)</span>
<span id="cb50-5"><a href="#cb50-5"></a>label_dist.compute(data<span class="op">=</span>train_test_valid_dataset[<span class="st">"train"</span>][<span class="st">"score"</span>]), label_dist.compute(data<span class="op">=</span>train_test_valid_dataset[<span class="st">"valid"</span>][<span class="st">"score"</span>]), label_dist.compute(data<span class="op">=</span>train_test_valid_dataset[<span class="st">"test"</span>][<span class="st">"score"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d26a8b1b0574493db3b9f71031227e77","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>({'label_distribution': {'labels': [1, 0],
   'fractions': [0.16461852608130684, 0.8353814739186931]},
  'label_skew': 1.8087864265977875},
 {'label_distribution': {'labels': [0, 1],
   'fractions': [0.8348930481283422, 0.16510695187165775]},
  'label_skew': 1.8040061996868444},
 {'label_distribution': {'labels': [0, 1],
   'fractions': [0.8350033400133601, 0.16499665998663995]},
  'label_skew': 1.8050841379113802})</code></pre>
</div>
</div>
</div>
</section>
<section id="content" class="slide level2">
<h2>Content</h2>
<p>Next, we will look at the content via topic modeling.<br>
We use a recent model called <a href="https://arxiv.org/abs/2203.05794">BERTopic</a> (2022).</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>docs.<span class="bu">map</span>(<span class="kw">lambda</span> x: {<span class="st">"title_text"</span>: x[<span class="st">"title"</span>] <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> x[<span class="st">"text"</span>]})[<span class="st">"title_text"</span>][:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0af2e45ee9ad4f2ea2834a1156412b01","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>['A hybrid of genetic algorithm and particle swarm optimization for recurrent network design: An evolutionary recurrent network which automates the design of recurrent neural/fuzzy networks using a new evolutionary learning algorithm is proposed in this paper. This new evolutionary learning algorithm is based on a hybrid of genetic algorithm (GA) and particle swarm optimization (PSO), and is thus called HGAPSO. In HGAPSO, individuals in a new generation are created, not only by crossover and mutation operation as in GA, but also by PSO. The concept of elite strategy is adopted in HGAPSO, where the upper-half of the best-performing individuals in a population are regarded as elites. However, instead of being reproduced directly to the next generation, these elites are first enhanced. The group constituted by the elites is regarded as a swarm, and each elite corresponds to a particle within it. In this regard, the elites are enhanced by PSO, an operation which mimics the maturing phenomenon in nature. These enhanced elites constitute half of the population in the new generation, whereas the other half is generated by performing crossover and mutation operation on these enhanced elites. HGAPSO is applied to recurrent neural/fuzzy network design as follows. For recurrent neural network, a fully connected recurrent neural network is designed and applied to a temporal sequence production problem. For recurrent fuzzy network design, a Takagi-Sugeno-Kang-type recurrent fuzzy network is designed and applied to dynamic plant control. The performance of HGAPSO is compared to both GA and PSO in these recurrent networks design problems, demonstrating its superiority.',
 'A Hybrid EP and SQP for Dynamic Economic Dispatch with Nonsmooth Fuel Cost Function: Dynamic economic dispatch (DED) is one of the main functions of power generation operation and control. It determines the optimal settings of generator units with predicted load demand over a certain period of time. The objective is to operate an electric power system most economically while the system is operating within its security limits. This paper proposes a new hybrid methodology for solving DED. The proposed method is developed in such a way that a simple evolutionary programming (EP) is applied as a based level search, which can give a good direction to the optimal global region, and a local search sequential quadratic programming (SQP) is used as a fine tuning to determine the optimal solution at the final. Ten units test system with nonsmooth fuel cost function is used to illustrate the effectiveness of the proposed method compared with those obtained from EP and SQP alone.']</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a>model_name <span class="op">=</span> <span class="st">'sentence-transformers/all-MiniLM-L6-v2'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="im">from</span> bertopic <span class="im">import</span> BERTopic</span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="im">from</span> bertopic.vectorizers <span class="im">import</span> ClassTfidfTransformer</span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="im">import</span> plotly</span>
<span id="cb55-4"><a href="#cb55-4"></a></span>
<span id="cb55-5"><a href="#cb55-5"></a>docs_for_analysis <span class="op">=</span> docs.<span class="bu">map</span>(<span class="kw">lambda</span> x: {<span class="st">"title_text"</span>: x[<span class="st">"title"</span>] <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> x[<span class="st">"text"</span>]})[<span class="st">"title_text"</span>]</span>
<span id="cb55-6"><a href="#cb55-6"></a>topic_model <span class="op">=</span> BERTopic(embedding_model<span class="op">=</span>model_name, ctfidf_model<span class="op">=</span>ClassTfidfTransformer(reduce_frequent_words<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb55-7"><a href="#cb55-7"></a>topic_model.fit(docs_for_analysis)</span>
<span id="cb55-8"><a href="#cb55-8"></a>topic_model.get_topic_info().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7bf01410444a442a96cb09b1dc3dd1fa","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d4bf3930682544ce9f3000f097d511aa","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9367a394ec0446ea895ee72cefa5709b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1a1a3857fc8c41c593cb1bfa991a4e35","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a57111ff105e4c038c05ea6fcef0e358","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"01680fb5de2743bb922757f087068d90","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ed5f3a2a4d6a43f8a7a269803b9d9c92","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d084dfedb738476aa5df69d070dbae24","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"02d24297150248c6bf82c51c3c306377","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"752d710bb6be422aae5690385cf86340","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"be4484e6b1624103a0e6346873b3d15f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"39f4dc3b478849f6a34a1dc5d3fa419c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"117b4f5ce99c432098bcc53cc2c02e4c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"72778290627c48f09757b576040ec683","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Topic</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Representation</th>
<th data-quarto-table-cell-role="th">Representative_Docs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-1</td>
<td>8734</td>
<td>-1_personality_object_health_objects</td>
<td>[personality, object, health, objects, query, ...</td>
<td>[The Cascade-Correlation Learning Architecture...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>327</td>
<td>0_antenna_patch_radiation_polarized</td>
<td>[antenna, patch, radiation, polarized, microst...</td>
<td>[Low-Cost High-Gain and Broadband Substrate- I...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>326</td>
<td>1_reinforcement_rl_policy_reward</td>
<td>[reinforcement, rl, policy, reward, agent, cri...</td>
<td>[GQ ( λ ) : A general gradient algorithm for t...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>306</td>
<td>2_cortex_cortical_brain_fmri</td>
<td>[cortex, cortical, brain, fmri, hippocampus, f...</td>
<td>[Cortical hubs revealed by intrinsic functiona...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3</td>
<td>241</td>
<td>3_imagenet_accelerator_dropout_dnns</td>
<td>[imagenet, accelerator, dropout, dnns, cifar, ...</td>
<td>[Incremental Network Quantization: Towards Los...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="explain-embeddings-umap-plot" class="slide level2">
<h2>Explain Embeddings (UMAP plot)</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>topic_model.reduce_topics(docs_for_analysis, nr_topics<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb56-2"><a href="#cb56-2"></a>fig <span class="op">=</span> topic_model.visualize_documents(docs_for_analysis)</span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="co"># plotly.offline.plot(fig, filename='bertopic_doc_embeddings.svg', image="svg")</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>fig.write_image(<span class="st">"bertopic_doc_embeddings.svg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"943fffbb1aef42c28e95089189ace668","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> SVG</span>
<span id="cb57-2"><a href="#cb57-2"></a>SVG(<span class="st">'bertopic_doc_embeddings.svg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<p><img data-src="air23-transformer4ir-tutorial_files/figure-revealjs/cell-35-output-1.svg"></p>
</div>
</div>
</div>
</section></section>
<section>
<section id="bert-4-reranking---monobert-cross-encoder" class="title-slide slide level1 agenda-slide center">
<h1>BERT 4 Reranking - monoBERT (= Cross-encoder)</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<p>Idea:</p>
<ul>
<li>Concat and predict.</li>
<li>Can directly use pretrained architectures.</li>
<li>Just fine-tuning required.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://raw.githubusercontent.com/UKPLab/sentence-transformers/master/docs/img/CrossEncoder.png" height="300"></p>
<figcaption>Cross Encoder</figcaption>
</figure>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb58-2"><a href="#cb58-2"></a></span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="kw">class</span> IRDataset(Dataset):</span>
<span id="cb58-4"><a href="#cb58-4"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, queries_ds, docs_ds, qrel_ds, mode<span class="op">=</span><span class="st">"cross"</span>):</span>
<span id="cb58-5"><a href="#cb58-5"></a>        <span class="va">self</span>.mode <span class="op">=</span> mode</span>
<span id="cb58-6"><a href="#cb58-6"></a>        </span>
<span id="cb58-7"><a href="#cb58-7"></a>        qrels <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb58-8"><a href="#cb58-8"></a>        </span>
<span id="cb58-9"><a href="#cb58-9"></a>        <span class="kw">def</span> transform(x):</span>
<span id="cb58-10"><a href="#cb58-10"></a>            q, d, r <span class="op">=</span> x[<span class="st">"query-id"</span>], x[<span class="st">"corpus-id"</span>], x[<span class="st">"score"</span>]</span>
<span id="cb58-11"><a href="#cb58-11"></a>            </span>
<span id="cb58-12"><a href="#cb58-12"></a>            q_idx <span class="op">=</span> queries_ds[<span class="st">"_id"</span>].index(q)</span>
<span id="cb58-13"><a href="#cb58-13"></a>            x[<span class="st">"query_text"</span>] <span class="op">=</span> queries_ds[q_idx][<span class="st">"text"</span>]</span>
<span id="cb58-14"><a href="#cb58-14"></a>            d_idx <span class="op">=</span> docs_ds[<span class="st">"_id"</span>].index(d)</span>
<span id="cb58-15"><a href="#cb58-15"></a>            x[<span class="st">"doc_content"</span>] <span class="op">=</span> docs_ds[d_idx][<span class="st">"title"</span>] <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> docs_ds[d_idx][<span class="st">"text"</span>]</span>
<span id="cb58-16"><a href="#cb58-16"></a>            x[<span class="st">"label"</span>] <span class="op">=</span> <span class="bu">float</span>(r)</span>
<span id="cb58-17"><a href="#cb58-17"></a>            </span>
<span id="cb58-18"><a href="#cb58-18"></a>            <span class="cf">if</span> r:</span>
<span id="cb58-19"><a href="#cb58-19"></a>                qrels[q].add(d)</span>
<span id="cb58-20"><a href="#cb58-20"></a>            </span>
<span id="cb58-21"><a href="#cb58-21"></a>            <span class="cf">return</span> x</span>
<span id="cb58-22"><a href="#cb58-22"></a>        </span>
<span id="cb58-23"><a href="#cb58-23"></a>        qrel_ds <span class="op">=</span> qrel_ds.<span class="bu">map</span>(transform)</span>
<span id="cb58-24"><a href="#cb58-24"></a>            </span>
<span id="cb58-25"><a href="#cb58-25"></a>        <span class="va">self</span>.q_ids <span class="op">=</span> qrel_ds[<span class="st">"query-id"</span>]</span>
<span id="cb58-26"><a href="#cb58-26"></a>        <span class="va">self</span>.d_ids <span class="op">=</span> qrel_ds[<span class="st">"corpus-id"</span>]</span>
<span id="cb58-27"><a href="#cb58-27"></a>        <span class="va">self</span>.qrels <span class="op">=</span> qrels</span>
<span id="cb58-28"><a href="#cb58-28"></a>                </span>
<span id="cb58-29"><a href="#cb58-29"></a>        <span class="va">self</span>.queries <span class="op">=</span> qrel_ds[<span class="st">"query_text"</span>]</span>
<span id="cb58-30"><a href="#cb58-30"></a>        <span class="va">self</span>.docs <span class="op">=</span> qrel_ds[<span class="st">"doc_content"</span>]</span>
<span id="cb58-31"><a href="#cb58-31"></a>        <span class="va">self</span>.labels <span class="op">=</span> qrel_ds[<span class="st">"label"</span>]</span>
<span id="cb58-32"><a href="#cb58-32"></a></span>
<span id="cb58-33"><a href="#cb58-33"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx):</span>
<span id="cb58-34"><a href="#cb58-34"></a>        qs <span class="op">=</span> <span class="va">self</span>.queries[idx]</span>
<span id="cb58-35"><a href="#cb58-35"></a>        ds <span class="op">=</span> <span class="va">self</span>.docs[idx]</span>
<span id="cb58-36"><a href="#cb58-36"></a>        <span class="cf">if</span> <span class="va">self</span>.mode <span class="op">==</span> <span class="st">"rep"</span>:</span>
<span id="cb58-37"><a href="#cb58-37"></a>            <span class="cf">if</span> <span class="bu">type</span>(idx) <span class="kw">is</span> <span class="bu">int</span>:</span>
<span id="cb58-38"><a href="#cb58-38"></a>                text_list <span class="op">=</span> [{<span class="st">"query"</span>: qs}, {<span class="st">"doc"</span>: ds}]</span>
<span id="cb58-39"><a href="#cb58-39"></a>            <span class="cf">else</span>:</span>
<span id="cb58-40"><a href="#cb58-40"></a>                text_list <span class="op">=</span> [[{<span class="st">"query"</span>: q} <span class="cf">for</span> q <span class="kw">in</span> qs], [{<span class="st">"doc"</span>: d} <span class="cf">for</span> d <span class="kw">in</span> ds]]</span>
<span id="cb58-41"><a href="#cb58-41"></a>            <span class="cf">return</span> InputExample(texts<span class="op">=</span>text_list, label<span class="op">=</span><span class="va">self</span>.labels[idx])</span>
<span id="cb58-42"><a href="#cb58-42"></a>        <span class="cf">return</span> InputExample(texts<span class="op">=</span>[qs, ds], label<span class="op">=</span><span class="va">self</span>.labels[idx])</span>
<span id="cb58-43"><a href="#cb58-43"></a>    </span>
<span id="cb58-44"><a href="#cb58-44"></a>    <span class="kw">def</span> set_mode(<span class="va">self</span>, mode):</span>
<span id="cb58-45"><a href="#cb58-45"></a>        <span class="va">self</span>.mode <span class="op">=</span> mode</span>
<span id="cb58-46"><a href="#cb58-46"></a></span>
<span id="cb58-47"><a href="#cb58-47"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb58-48"><a href="#cb58-48"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a>train_ds <span class="op">=</span> IRDataset(queries, docs, train_test_valid_dataset[<span class="st">"train"</span>])</span>
<span id="cb59-2"><a href="#cb59-2"></a>valid_ds <span class="op">=</span> IRDataset(queries, docs, train_test_valid_dataset[<span class="st">"valid"</span>])</span>
<span id="cb59-3"><a href="#cb59-3"></a>train_ds[<span class="dv">0</span>].__dict__</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"287ab1ad098342a288b92ac4204761fc","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0ffa4bf041824019b1a082587c285614","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>{'guid': '',
 'texts': ['Toward an IT governance maturity self-assessment model using EFQM and CobiT',
  'A maturity model for information governance: Information Governance (IG) as defined by Gartner is the “specification of decision rights and an accountability framework to encourage desirable behavior in the valuation, creation, storage, use, archival and deletion of information. Includes the processes, roles, standards and metrics that ensure the effective and efficient use of information in enabling an organization to achieve its goals”. In this paper, we present how to create an IG maturity model based on existing reference documents. The process is based on existing maturity model development methods. These methods allow for a systematic approach to maturity model development backed up by a well-known and proved scientific research method called Design Science Research. Then, based on the maturity model proposed in this paper, an assessment is conducted and the results are presented, this assessment was conducted as a self-assessment in the context of the EC-funded E-ARK project for the seven pilots of the project. The main conclusion from this initial assessment is that there is much room for improvement with most pilots achieving results between maturity level two and three. As future work, the goal is to analyze other references from different domains, such as, records management. These references will enhance, detail and help develop the maturity model making it even more valuable for all types of organization that deal with information governance.'],
 'label': 1.0}</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>monoBERT <span class="op">=</span> CrossEncoder(model_name, <span class="co"># We use cross-encoder as monoBERT example</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>                     num_labels<span class="op">=</span><span class="dv">1</span>, <span class="co"># Perform binary classification</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>                     device<span class="op">=</span><span class="va">None</span>,  <span class="co"># Will use CUDA if available</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"51772e5c6de441659d100de63d2b9d18","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d575689fbcfb4a25acd0d16e03fe092f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"05852916bedc457086968df5a84a3220","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7572835e6de24dc38726b9389b6bef99","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"73a3072b5c1f45969674aa2a1a72a7f9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ddd38f83cfd3480e80e95206986bb46a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a>monoBERT.predict([ex0[:<span class="dv">2</span>], ex1[:<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7b3404feb01c46948b32b4ffa54d0ba1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>array([0.5064283, 0.5081911], dtype=float32)</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a><span class="bu">print</span>(train_ds[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;InputExample&gt; label: 1.0, texts: Toward an IT governance maturity self-assessment model using EFQM and CobiT; A maturity model for information governance: Information Governance (IG) as defined by Gartner is the “specification of decision rights and an accountability framework to encourage desirable behavior in the valuation, creation, storage, use, archival and deletion of information. Includes the processes, roles, standards and metrics that ensure the effective and efficient use of information in enabling an organization to achieve its goals”. In this paper, we present how to create an IG maturity model based on existing reference documents. The process is based on existing maturity model development methods. These methods allow for a systematic approach to maturity model development backed up by a well-known and proved scientific research method called Design Science Research. Then, based on the maturity model proposed in this paper, an assessment is conducted and the results are presented, this assessment was conducted as a self-assessment in the context of the EC-funded E-ARK project for the seven pilots of the project. The main conclusion from this initial assessment is that there is much room for improvement with most pilots achieving results between maturity level two and three. As future work, the goal is to analyze other references from different domains, such as, records management. These references will enhance, detail and help develop the maturity model making it even more valuable for all types of organization that deal with information governance.</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>train_dl <span class="op">=</span> DataLoader(train_ds, batch_size<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="co"># We need sentence pairs format for the library here.</span></span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="co"># valid_dl = DataLoader(valid_ds, batch_size=32)</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>sentence_pairs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(valid_ds.queries, valid_ds.docs))</span>
<span id="cb66-5"><a href="#cb66-5"></a>labels <span class="op">=</span> valid_ds.labels</span>
<span id="cb66-6"><a href="#cb66-6"></a><span class="bu">len</span>(train_dl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>842</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>monoBERT.model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>BertForSequenceClassification(
  (bert): BertModel(
    (embeddings): BertEmbeddings(
      (word_embeddings): Embedding(30522, 384, padding_idx=0)
      (position_embeddings): Embedding(512, 384)
      (token_type_embeddings): Embedding(2, 384)
      (LayerNorm): LayerNorm((384,), eps=1e-12, elementwise_affine=True)
      (dropout): Dropout(p=0.1, inplace=False)
    )
    (encoder): BertEncoder(
      (layer): ModuleList(
        (0-5): 6 x BertLayer(
          (attention): BertAttention(
            (self): BertSelfAttention(
              (query): Linear(in_features=384, out_features=384, bias=True)
              (key): Linear(in_features=384, out_features=384, bias=True)
              (value): Linear(in_features=384, out_features=384, bias=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
            (output): BertSelfOutput(
              (dense): Linear(in_features=384, out_features=384, bias=True)
              (LayerNorm): LayerNorm((384,), eps=1e-12, elementwise_affine=True)
              (dropout): Dropout(p=0.1, inplace=False)
            )
          )
          (intermediate): BertIntermediate(
            (dense): Linear(in_features=384, out_features=1536, bias=True)
            (intermediate_act_fn): GELUActivation()
          )
          (output): BertOutput(
            (dense): Linear(in_features=1536, out_features=384, bias=True)
            (LayerNorm): LayerNorm((384,), eps=1e-12, elementwise_affine=True)
            (dropout): Dropout(p=0.1, inplace=False)
          )
        )
      )
    )
    (pooler): BertPooler(
      (dense): Linear(in_features=384, out_features=384, bias=True)
      (activation): Tanh()
    )
  )
  (dropout): Dropout(p=0.1, inplace=False)
  (classifier): Linear(in_features=384, out_features=1, bias=True)
)</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a>monoBERT.__dict__.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>dict_keys(['config', 'model', 'tokenizer', 'max_length', '_target_device', 'default_activation_function'])</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a>class_evaluator <span class="op">=</span> sentence_transformers.cross_encoder.evaluation.CEBinaryClassificationEvaluator(sentence_pairs, labels, show_progress_bar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-2"><a href="#cb72-2"></a>monoBERT.fit(train_dataloader<span class="op">=</span>train_dl,</span>
<span id="cb72-3"><a href="#cb72-3"></a>          loss_fct<span class="op">=</span><span class="va">None</span>,  <span class="co"># uses nn.BCEWithLogitsLoss() </span></span>
<span id="cb72-4"><a href="#cb72-4"></a>          evaluator<span class="op">=</span>class_evaluator,</span>
<span id="cb72-5"><a href="#cb72-5"></a>          epochs<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb72-6"><a href="#cb72-6"></a>          optimizer_class<span class="op">=</span>torch.optim.AdamW,</span>
<span id="cb72-7"><a href="#cb72-7"></a>          show_progress_bar<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb72-8"><a href="#cb72-8"></a>          save_best_model<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb72-9"><a href="#cb72-9"></a>          output_path<span class="op">=</span><span class="st">"./"</span>,</span>
<span id="cb72-10"><a href="#cb72-10"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"904b8e6c3aab4c1fb122981f35e265d1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6721b8ad6a854a1e9947b06a94632f32","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0109b98a2fcb41d2904748f43cf6fc8b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3b7388d760664132b11ff5a17a6c7f15","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c302e0696f494e70b5141c2853b09562","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"505767764e93494182f3fb06e2eca655","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1ea536781f2d46f5a4f2e6f1dd0f6d2b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bfa23ff2e6b14915b977b7facb08582b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ae0b11b09d044b90bf532a5bcf1ef9a5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0f8157c8c7874ef1b7d54594a7f3535f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b29f325c63504396bdd79d853a93dad1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># Tip: look at CUDA GPU.</span></span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="op">!</span>nvidia<span class="op">-</span>smi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>Mon Nov 20 16:22:17 2023       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 470.161.03   Driver Version: 470.161.03   CUDA Version: 11.4     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla P100-PCIE...  Off  | 00000000:00:04.0 Off |                    0 |
| N/A   70C    P0    54W / 250W |   9533MiB / 16280MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
+-----------------------------------------------------------------------------+</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a>monoBERT.predict([ex0[:<span class="dv">2</span>], ex1[:<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"486ce76325d248fdaaef4067e55aae3a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>array([0.45407605, 0.49909475], dtype=float32)</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"CEBinaryClassificationEvaluator_results.csv"</span>)</span>
<span id="cb77-2"><a href="#cb77-2"></a>df.tail(n<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">steps</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
<th data-quarto-table-cell-role="th">Accuracy_Threshold</th>
<th data-quarto-table-cell-role="th">F1</th>
<th data-quarto-table-cell-role="th">F1_Threshold</th>
<th data-quarto-table-cell-role="th">Precision</th>
<th data-quarto-table-cell-role="th">Recall</th>
<th data-quarto-table-cell-role="th">Average_Precision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>-1</td>
<td>0.836230</td>
<td>0.271901</td>
<td>0.362869</td>
<td>0.194206</td>
<td>0.278017</td>
<td>0.522267</td>
<td>0.301740</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>-1</td>
<td>0.844251</td>
<td>0.498470</td>
<td>0.448179</td>
<td>0.234365</td>
<td>0.342612</td>
<td>0.647773</td>
<td>0.396195</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>-1</td>
<td>0.891043</td>
<td>0.537126</td>
<td>0.650096</td>
<td>0.307447</td>
<td>0.615942</td>
<td>0.688259</td>
<td>0.673045</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>-1</td>
<td>0.911765</td>
<td>0.636082</td>
<td>0.702586</td>
<td>0.442940</td>
<td>0.751152</td>
<td>0.659919</td>
<td>0.770558</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>-1</td>
<td>0.923797</td>
<td>0.679859</td>
<td>0.739726</td>
<td>0.679859</td>
<td>0.848168</td>
<td>0.655870</td>
<td>0.819789</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a>df.set_index(<span class="st">"epoch"</span>).drop(columns<span class="op">=</span>[<span class="st">"steps"</span>]).plot()</span>
<span id="cb78-2"><a href="#cb78-2"></a>plt.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="air23-transformer4ir-tutorial_files/figure-revealjs/cell-48-output-2.png"></p>
</div>
</div>
</div>
</section>
<section id="training-considerations" class="slide level2">
<h2>Training considerations</h2>
<ul>
<li>Overfitting</li>
<li>Architecture</li>
<li>Hyperparameter tuning</li>
<li>Significance of results</li>
</ul>
</section></section>
<section>
<section id="what-is-a-transformer-high-level-overview" class="title-slide slide level1 agenda-slide center">
<h1>What is a Transformer? (High-level Overview)</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section id="why-transformers" class="slide level2">
<h2>Why transformers:</h2>
<ul>
<li>Contextualized embeddings, such as <a href="https://arxiv.org/abs/1802.05365">ElMo</a> (2018).</li>
<li>Transfer learning, such as <a href="https://arxiv.org/abs/1801.06146">ULMFit</a> (2018).</li>
<li>Wide-variety of NLP tasks.</li>
</ul>
<p>Transformers use multi-head Attention (<a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a> - 2017):</p>

<img data-src="https://jalammar.github.io/images/t/transformer_multi-headed_self-attention-recap.png" class="r-stretch quarto-figure-center"><p class="caption">Illustrated Transformer Overview</p><p>We end up with an embedding, that can then customized with a special head (e.g., classification or pooling).</p>
<p>Today focus on <a href="https://arxiv.org/abs/1810.04805">BERT</a> (2018, bi-directional with masking).</p>
</section>
<section class="slide level2">

<div class="columns">
<div class="column">
<p>Attention:</p>
<p><span class="math display">\[
softmax(\frac{Q \times K^T}{\sqrt{d_k}})V = Z
\]</span></p>
<p>Note that:</p>
<ul>
<li>Key, Value same source.</li>
<li>Query, Key same length.</li>
<li>Decoder queries encoder.</li>
</ul>
</div><div class="column">
<p><img data-src="https://vaclavkosar.com/images/transformer-full-model.png"></p>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer, AutoModel, AutoModelForSequenceClassification</span>
<span id="cb80-2"><a href="#cb80-2"></a></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="co"># Tokenizer and model must match</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>ex_tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(model_name)</span>
<span id="cb80-5"><a href="#cb80-5"></a>ex_model <span class="op">=</span> AutoModel.from_pretrained(model_name)</span>
<span id="cb80-6"><a href="#cb80-6"></a>ex_model_with_head <span class="op">=</span> AutoModelForSequenceClassification.from_pretrained(model_name)  <span class="co"># Needs fine-tuning, here for demonstration</span></span>
<span id="cb80-7"><a href="#cb80-7"></a></span>
<span id="cb80-8"><a href="#cb80-8"></a>test_sentences <span class="op">=</span> [<span class="st">"This is the first sentence with complex tokens, such as SentenceTransformers."</span>, <span class="st">"We can batch multiple sentences."</span>]</span>
<span id="cb80-9"><a href="#cb80-9"></a></span>
<span id="cb80-10"><a href="#cb80-10"></a>ex_tokenized <span class="op">=</span> ex_tokenizer(test_sentences, return_tensors<span class="op">=</span><span class="st">"pt"</span>, padding<span class="op">=</span><span class="va">True</span>, truncation<span class="op">=</span><span class="va">True</span>)  <span class="co"># Collates data with padding</span></span>
<span id="cb80-11"><a href="#cb80-11"></a>ex_res <span class="op">=</span> ex_model(<span class="op">**</span>ex_tokenized)</span>
<span id="cb80-12"><a href="#cb80-12"></a>ex_res_with_head <span class="op">=</span> ex_model_with_head(<span class="op">**</span>ex_tokenized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Tokenized text:"</span>)  <span class="co"># Word Piece Tokenization</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="bu">print</span>(ex_tokenizer.tokenize(test_sentences))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Tokenized text:
['this', 'is', 'the', 'first', 'sentence', 'with', 'complex', 'token', '##s', ',', 'such', 'as', 'sentence', '##tra', '##ns', '##form', '##ers', '.', 'we', 'can', 'batch', 'multiple', 'sentences', '.']</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Output Dictionary:"</span>)</span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="bu">print</span>(ex_res.keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Output Dictionary:
odict_keys(['last_hidden_state', 'pooler_output'])</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Output Size:"</span>)</span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="bu">print</span>(ex_res.last_hidden_state.size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Output Size:
torch.Size([2, 20, 384])</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Pooled Embeddings (truncated):"</span>)</span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="bu">print</span>(ex_res.pooler_output.shape, ex_res.pooler_output[:, :<span class="dv">7</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Pooled Embeddings (truncated):
torch.Size([2, 384]) tensor([[-0.0595,  0.0151,  0.0587,  0.0922, -0.0913, -0.0640,  0.0419],
        [ 0.0048,  0.0145,  0.0123,  0.0590, -0.1448, -0.0045, -0.0301]],
       grad_fn=&lt;SliceBackward0&gt;)</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Token IDs:"</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="bu">print</span>(ex_tokenized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Token IDs:
{'input_ids': tensor([[  101,  2023,  2003,  1996,  2034,  6251,  2007,  3375, 19204,  2015,
          1010,  2107,  2004,  6251,  6494,  3619, 14192,  2545,  1012,   102],
        [  101,  2057,  2064, 14108,  3674, 11746,  1012,   102,     0,     0,
             0,     0,     0,     0,     0,     0,     0,     0,     0,     0]]), 'token_type_ids': tensor([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]), 'attention_mask': tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])}</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Contextualized Token Embeddings (truncated):"</span>)</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="bu">print</span>(ex_res.last_hidden_state[:, :<span class="dv">3</span>, :<span class="dv">7</span>])  <span class="co"># First 3 tokens)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Contextualized Token Embeddings (truncated):
tensor([[[-0.1560, -0.1154,  0.0731,  0.2994,  0.0485,  0.0800,  0.1049],
         [ 0.2525,  0.9195,  0.4429,  0.7421,  0.4402,  0.2827,  1.2313],
         [ 0.0174,  0.3108,  0.0699,  0.3103,  0.2146,  0.4123,  0.3589]],

        [[ 0.1666, -0.2453,  0.0160,  0.0463,  0.0391,  0.0391,  0.2853],
         [ 0.1173, -0.0858,  0.0132, -0.0607,  0.2865,  0.2517,  0.5110],
         [-0.0912, -0.3036, -0.3637,  0.1121,  0.0017,  0.5838,  0.1054]]],
       grad_fn=&lt;SliceBackward0&gt;)</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Predicted Values (not fine-tuning)"</span>)</span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="bu">print</span>(ex_res_with_head)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-stdout">
<pre><code>
Predicted Values (not fine-tuning)
SequenceClassifierOutput(loss=None, logits=tensor([[0.0310, 0.0070],
        [0.0281, 0.0279]], grad_fn=&lt;AddmmBackward0&gt;), hidden_states=None, attentions=None)</code></pre>
</div>
</div>
</div>
</section>
<section id="tokenization" class="slide level2">
<h2>Tokenization</h2>
<p>Can be learned. BERT uses WordPiece.<br>
Based on common sub-words (in comparison to word- or character-based).<br>
Can deal with unknown compound words.</p>
<h3 id="special-tokens">Special Tokens</h3>
<p>In BERT:<br>
[CLS] sent1 [SEP] sent2 [SEP]</p>
<p>Other tokens:<br>
- [MASK] - [UNK] - [PAD]</p>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># Uses Mean pooling</span></span>
<span id="cb95-2"><a href="#cb95-2"></a>topic_model.embedding_model.embedding_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>SentenceTransformer(
  (0): Transformer({'max_seq_length': 256, 'do_lower_case': False}) with Transformer model: BertModel 
  (1): Pooling({'word_embedding_dimension': 384, 'pooling_mode_cls_token': False, 'pooling_mode_mean_tokens': True, 'pooling_mode_max_tokens': False, 'pooling_mode_mean_sqrt_len_tokens': False})
  (2): Normalize()
)</code></pre>
</div>
</div>
</div>
</section>
<section id="common-pooling-modes" class="slide level2">
<h2>Common Pooling Modes</h2>
<ul>
<li>Mean Pooling (average)</li>
<li>Max Pooling</li>
<li>Sequence-length dependant</li>
<li>Special token ([CLS] in BERT)</li>
</ul>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Starts with embeddings</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>topic_model.embedding_model.embedding_model[<span class="dv">0</span>]._modules[<span class="st">"auto_model"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>BertModel(
  (embeddings): BertEmbeddings(
    (word_embeddings): Embedding(30522, 384, padding_idx=0)
    (position_embeddings): Embedding(512, 384)
    (token_type_embeddings): Embedding(2, 384)
    (LayerNorm): LayerNorm((384,), eps=1e-12, elementwise_affine=True)
    (dropout): Dropout(p=0.1, inplace=False)
  )
  (encoder): BertEncoder(
    (layer): ModuleList(
      (0-5): 6 x BertLayer(
        (attention): BertAttention(
          (self): BertSelfAttention(
            (query): Linear(in_features=384, out_features=384, bias=True)
            (key): Linear(in_features=384, out_features=384, bias=True)
            (value): Linear(in_features=384, out_features=384, bias=True)
            (dropout): Dropout(p=0.1, inplace=False)
          )
          (output): BertSelfOutput(
            (dense): Linear(in_features=384, out_features=384, bias=True)
            (LayerNorm): LayerNorm((384,), eps=1e-12, elementwise_affine=True)
            (dropout): Dropout(p=0.1, inplace=False)
          )
        )
        (intermediate): BertIntermediate(
          (dense): Linear(in_features=384, out_features=1536, bias=True)
          (intermediate_act_fn): GELUActivation()
        )
        (output): BertOutput(
          (dense): Linear(in_features=1536, out_features=384, bias=True)
          (LayerNorm): LayerNorm((384,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
    )
  )
  (pooler): BertPooler(
    (dense): Linear(in_features=384, out_features=384, bias=True)
    (activation): Tanh()
  )
)</code></pre>
</div>
</div>
</div>
</section>
<section id="types-of-transformers" class="slide level2">
<h2>Types of transformers</h2>
<p>BERT only uses Encoder Layers.</p>
<ul>
<li>Encoders (e.g., BERT, RoBERTa): auto-encoding models - NLU</li>
<li>Decoders (e.g., GPT): auto-regressive models - NLG</li>
<li>Seq2Seq (e.g., BART): encoder-decoder models - Translation</li>
</ul>
<p><a href="https://huggingface.co/course/chapter1/9">Overview of Models</a></p>

<img data-src="https://jalammar.github.io/images/t/The_transformer_encoder_decoder_stack.png" class="r-stretch quarto-figure-center"><p class="caption">Transfomer Layers</p></section></section>
<section>
<section id="bert-4-retrieval---representation-based-bi-encoder" class="title-slide slide level1 agenda-slide center">
<h1>BERT 4 Retrieval - Representation-based (= Bi-encoder)</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-post-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section id="idea" class="slide level2">
<h2>Idea:</h2>
<ul>
<li>Train embeddings for queries and documents.</li>
<li>Asymmetric architecture vs Siamese network. (we use the latter for simplicity)</li>
<li>Similarity function -&gt; loss.</li>
</ul>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Embedding Based Retrieval</th>
<th style="text-align: center;">Architecture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img data-src="https://raw.githubusercontent.com/UKPLab/sentence-transformers/master/docs/img/SemanticSearch.png" alt="Embedding Based Retrieval"></td>
<td style="text-align: center;"><img data-src="https://www.sbert.net/_images/SBERT_Siamese_Network.png" alt="Architecture"></td>
</tr>
</tbody>
</table>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a>repBased <span class="op">=</span> SentenceTransformer(model_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>qs, ds <span class="op">=</span> repBased.encode([{<span class="st">"query"</span>: ex0[<span class="dv">0</span>]}, {<span class="st">"query"</span>: ex1[<span class="dv">0</span>]}]), repBased.encode([{<span class="st">"doc"</span>: ex0[<span class="dv">1</span>]}, {<span class="st">"doc"</span>: ex1[<span class="dv">0</span>]}])</span>
<span id="cb100-2"><a href="#cb100-2"></a>sentence_transformers.util.cos_sim(qs, ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5dc3e543a47a4d1d92b95d9a7d6d5dc9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fcd7f30be4c84922bc17bc2349f7dd36","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[0.1819, 0.1325],
        [0.0353, 1.0000]])</code></pre>
</div>
</div>
</div>
<h3 id="collate-batches">Collate Batches</h3>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a>train_ds.set_mode(<span class="st">"rep"</span>)</span>
<span id="cb102-2"><a href="#cb102-2"></a>valid_ds.set_mode(<span class="st">"rep"</span>)</span>
<span id="cb102-3"><a href="#cb102-3"></a>train_dl_repBased <span class="op">=</span> DataLoader(train_ds, batch_size<span class="op">=</span><span class="dv">32</span>, collate_fn<span class="op">=</span>repBased.smart_batching_collate)</span>
<span id="cb102-4"><a href="#cb102-4"></a>valid_dl_repBased <span class="op">=</span> DataLoader(valid_ds, batch_size<span class="op">=</span><span class="dv">32</span>, collate_fn<span class="op">=</span>repBased.smart_batching_collate)</span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="cf">assert</span> <span class="bu">next</span>(<span class="bu">iter</span>(train_dl_repBased))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a>queries_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(valid_ds.q_ids, valid_ds.queries))</span>
<span id="cb103-2"><a href="#cb103-2"></a>docs_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(valid_ds.d_ids, valid_ds.docs))</span>
<span id="cb103-3"><a href="#cb103-3"></a>qrels_dict <span class="op">=</span> valid_ds.qrels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">

</div>
</div>
<h3 id="train">Train</h3>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>ir_evaluator <span class="op">=</span> sentence_transformers.evaluation.InformationRetrievalEvaluator(queries_dict, docs_dict, qrels_dict, write_csv<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb104-2"><a href="#cb104-2"></a>repBased.fit(train_objectives<span class="op">=</span>[(train_dl_repBased, losses.CosineSimilarityLoss(repBased))],</span>
<span id="cb104-3"><a href="#cb104-3"></a>          evaluator<span class="op">=</span>ir_evaluator,</span>
<span id="cb104-4"><a href="#cb104-4"></a>          epochs<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb104-5"><a href="#cb104-5"></a>          optimizer_class<span class="op">=</span>torch.optim.AdamW,</span>
<span id="cb104-6"><a href="#cb104-6"></a>          show_progress_bar<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb104-7"><a href="#cb104-7"></a>          save_best_model<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb104-8"><a href="#cb104-8"></a>          output_path<span class="op">=</span><span class="st">"./"</span>,</span>
<span id="cb104-9"><a href="#cb104-9"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"655b58074cce4fbc975e07caac1c29f8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ef102762a8764443b64cd80225317b65","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a61e97799ebc405080cfa0eb326e26f4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"48c1830efb924aa8b0dc0a0e88802ece","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"07f94f769fb74fbabd73c46a2f190f55","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fd1a8d41ad8646509ed68ab44aad69d0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a>qs, ds <span class="op">=</span> repBased.encode([{<span class="st">"query"</span>: ex0[<span class="dv">0</span>]}, {<span class="st">"query"</span>: ex1[<span class="dv">0</span>]}]), repBased.encode([{<span class="st">"doc"</span>: ex0[<span class="dv">1</span>]}, {<span class="st">"doc"</span>: ex1[<span class="dv">0</span>]}])</span>
<span id="cb105-2"><a href="#cb105-2"></a>sentence_transformers.util.cos_sim(qs, ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9b42442f419b41d59b2179b1d0ba1444","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b3b57fec1db04ad5a91900ba35006697","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[0.4993, 0.1709],
        [0.2064, 1.0000]])</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"eval/Information-Retrieval_evaluation_results.csv"</span>)</span>
<span id="cb107-2"><a href="#cb107-2"></a>df.tail(n<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">steps</th>
<th data-quarto-table-cell-role="th">cos_sim-Accuracy@1</th>
<th data-quarto-table-cell-role="th">cos_sim-Accuracy@3</th>
<th data-quarto-table-cell-role="th">cos_sim-Accuracy@5</th>
<th data-quarto-table-cell-role="th">cos_sim-Accuracy@10</th>
<th data-quarto-table-cell-role="th">cos_sim-Precision@1</th>
<th data-quarto-table-cell-role="th">cos_sim-Recall@1</th>
<th data-quarto-table-cell-role="th">cos_sim-Precision@3</th>
<th data-quarto-table-cell-role="th">cos_sim-Recall@3</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">dot_score-Recall@1</th>
<th data-quarto-table-cell-role="th">dot_score-Precision@3</th>
<th data-quarto-table-cell-role="th">dot_score-Recall@3</th>
<th data-quarto-table-cell-role="th">dot_score-Precision@5</th>
<th data-quarto-table-cell-role="th">dot_score-Recall@5</th>
<th data-quarto-table-cell-role="th">dot_score-Precision@10</th>
<th data-quarto-table-cell-role="th">dot_score-Recall@10</th>
<th data-quarto-table-cell-role="th">dot_score-MRR@10</th>
<th data-quarto-table-cell-role="th">dot_score-NDCG@10</th>
<th data-quarto-table-cell-role="th">dot_score-MAP@100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>-1</td>
<td>0.318386</td>
<td>0.470852</td>
<td>0.538117</td>
<td>0.605381</td>
<td>0.318386</td>
<td>0.307175</td>
<td>0.162930</td>
<td>0.457399</td>
<td>...</td>
<td>0.307175</td>
<td>0.162930</td>
<td>0.457399</td>
<td>0.112108</td>
<td>0.522422</td>
<td>0.063677</td>
<td>0.587444</td>
<td>0.409075</td>
<td>0.448493</td>
<td>0.412652</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>-1</td>
<td>0.286996</td>
<td>0.466368</td>
<td>0.529148</td>
<td>0.609865</td>
<td>0.286996</td>
<td>0.273543</td>
<td>0.159940</td>
<td>0.450673</td>
<td>...</td>
<td>0.273543</td>
<td>0.159940</td>
<td>0.450673</td>
<td>0.110314</td>
<td>0.511211</td>
<td>0.064574</td>
<td>0.594170</td>
<td>0.389533</td>
<td>0.434542</td>
<td>0.391997</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>-1</td>
<td>0.273543</td>
<td>0.452915</td>
<td>0.533632</td>
<td>0.627803</td>
<td>0.273543</td>
<td>0.260090</td>
<td>0.155456</td>
<td>0.439462</td>
<td>...</td>
<td>0.260090</td>
<td>0.155456</td>
<td>0.439462</td>
<td>0.111211</td>
<td>0.515695</td>
<td>0.066368</td>
<td>0.609865</td>
<td>0.381621</td>
<td>0.432073</td>
<td>0.384038</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>-1</td>
<td>0.269058</td>
<td>0.461883</td>
<td>0.524664</td>
<td>0.632287</td>
<td>0.269058</td>
<td>0.253363</td>
<td>0.158445</td>
<td>0.446188</td>
<td>...</td>
<td>0.253363</td>
<td>0.158445</td>
<td>0.446188</td>
<td>0.110314</td>
<td>0.506726</td>
<td>0.066816</td>
<td>0.612108</td>
<td>0.378787</td>
<td>0.430048</td>
<td>0.381016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>-1</td>
<td>0.264574</td>
<td>0.452915</td>
<td>0.520179</td>
<td>0.627803</td>
<td>0.264574</td>
<td>0.246637</td>
<td>0.155456</td>
<td>0.434978</td>
<td>...</td>
<td>0.246637</td>
<td>0.155456</td>
<td>0.434978</td>
<td>0.110314</td>
<td>0.504484</td>
<td>0.066368</td>
<td>0.609865</td>
<td>0.378207</td>
<td>0.427841</td>
<td>0.378888</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a>df.set_index(<span class="st">"epoch"</span>).drop(columns<span class="op">=</span>[<span class="st">"steps"</span>]).plot(legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb108-2"><a href="#cb108-2"></a>plt.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>), ncol<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="air23-transformer4ir-tutorial_files/figure-revealjs/cell-66-output-2.png"></p>
</div>
</div>
</div>
</section>
<section id="similarity-search-index" class="slide level2">
<h2>Similarity Search Index</h2>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a><span class="im">from</span> datasets <span class="im">import</span> Dataset</span>
<span id="cb110-2"><a href="#cb110-2"></a>embs <span class="op">=</span> repBased.encode(<span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: {<span class="st">"doc"</span>: x}, docs_dict.values())))</span>
<span id="cb110-3"><a href="#cb110-3"></a>dataset <span class="op">=</span> Dataset.from_dict({<span class="st">"id"</span>: docs_dict.keys(), <span class="st">"txt"</span>: docs_dict.values(), <span class="st">"embeddings"</span>: embs})</span>
<span id="cb110-4"><a href="#cb110-4"></a>dataset.add_faiss_index(column<span class="op">=</span><span class="st">'embeddings'</span>)</span>
<span id="cb110-5"><a href="#cb110-5"></a>dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"060501d0541a4e478feae8f9cb1c592b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b8143bc612c0432ea27d5eac71ac79f8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>Dataset({
    features: ['id', 'txt', 'embeddings'],
    num_rows: 1487
})</code></pre>
</div>
</div>
</div>
<div class="cell columns column-output-location" data-vscode="{&quot;languageId&quot;:&quot;python&quot;}">
<div class="column">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a>query <span class="op">=</span> <span class="st">"deep learning transformer models for information retrieval"</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>q_embeddings <span class="op">=</span> repBased.encode([{<span class="st">"query"</span>: query}])[<span class="dv">0</span>]</span>
<span id="cb112-3"><a href="#cb112-3"></a>retrieved <span class="op">=</span> dataset.get_nearest_examples(<span class="st">'embeddings'</span>, query<span class="op">=</span>q_embeddings, k<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb112-4"><a href="#cb112-4"></a>transformed_scores <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>retrieved.scores<span class="op">/</span><span class="dv">2</span>  <span class="co"># to cosine similarity, assume normalized</span></span>
<span id="cb112-5"><a href="#cb112-5"></a>text_snippets <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x[:<span class="dv">50</span>] <span class="op">+</span> <span class="st">"..."</span>, retrieved.examples[<span class="st">"txt"</span>]))</span>
<span id="cb112-6"><a href="#cb112-6"></a>retrieved.examples[<span class="st">"id"</span>], transformed_scores, text_snippets, np.array(retrieved.examples[<span class="st">"embeddings"</span>]).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0b7c3bb5667f45aeb20488e159994557","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre><code>(['859af6e67aec769c58ec1ea6a971108a60df0b9d',
  'a426971fa937bc8d8388e8a657ff891c012a855f',
  '0ad0518637d61e8f4b151657797b067ec74418e4'],
 array([0.7006028 , 0.68879974, 0.68470454], dtype=float32),
 ['Structured Perceptron with Inexact Search: Structu...',
  'Deep Learning for Biomedical Information Retrieval...',
  'Semi-supervised deep learning by metric embedding:...'],
 (3, 384))</code></pre>
</div>
</div>
</div>
</section></section>
<section>
<section id="discussion" class="title-slide slide level1 agenda-slide center">
<h1>Discussion</h1>
<div class="agenda-heading">
<p>Agenda</p>
</div>
<div class="agenda">
<ol>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformers 4 IR</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Transformer by Examples</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Conducting an IR experiment</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>Analysis - BERTopic Showcase</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>BERT 4 Reranking - monoBERT (= Cross-encoder)</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>What is a Transformer? (High-level Overview)</p>
</div></li>
<li><div class="agenda-inactive agenda-pre-active">
<p>BERT 4 Retrieval - Representation-based (= Bi-encoder)</p>
</div></li>
<li><div class="agenda-active">
<p>Discussion</p>
</div></li>
</ol>
</div>
</section>
<section id="evaluation-considerations" class="slide level2">
<h2>Evaluation Considerations</h2>
<ul>
<li>Hyperparameter Tuning</li>
<li>Final Eval Test Set</li>
</ul>
</section>
<section id="putting-things-together" class="slide level2">
<h2>Putting things together</h2>
<ul>
<li>Multiple re-rankers (e.g., DuoBERT).<br>
</li>
<li>Evaluate (offline on test data) or online in production system.</li>
</ul>

<img data-src="https://raw.githubusercontent.com/UKPLab/sentence-transformers/master/docs/img/InformationRetrieval.png" class="r-stretch quarto-figure-center"><p class="caption">Two-Stage Retrieval</p></section>
<section id="tips-and-common-pitfalls-scaling." class="slide level2">
<h2>Tips and common pitfalls (scaling).</h2>
<ul>
<li>CUDA memory errors: start small before scaling up, reduce batch size or text length. More sophisticated methods like gradient accumulation also possible, but require custom training loops.</li>
<li>Issues with evaluation (mismatch of questions and experimental setup or data leakage).</li>
</ul>
</section>
<section id="future-directions" class="slide level2">
<h2>Future directions</h2>
<ul>
<li>Distillation (Student and Teacher, e.g., distilBERT from HF)</li>
<li>Prompt engineering (zero-shot) vs few-shot fine-tuning</li>
<li>Contrastive Learning (pretraining or auxiliary tasks) <img data-src="https://lilianweng.github.io/posts/2021-05-31-contrastive/triplet-loss.png" alt="Triplet Loss"></li>
</ul>
</section>
<section id="convergence-of-modalities" class="slide level2">
<h2>Convergence of Modalities</h2>
<ul>
<li>Recently, usage in Vision (<a href="https://arxiv.org/abs/2010.11929">ViT</a>)</li>
<li>Multi-modality (<a href="https://arxiv.org/abs/2103.00020">CLIP embeddings</a> in <a href="https://arxiv.org/abs/2112.10752">Stable Diffusion</a>) <img data-src="https://raw.githubusercontent.com/UKPLab/sentence-transformers/master/docs/img/ImageSearch.png" alt="Shared Image Text Space"></li>
</ul>
</section>
<section class="slide level2">

<p>“A photograph of an astronaut riding a horse” <img data-src="https://upload.wikimedia.org/wikipedia/commons/3/32/A_photograph_of_an_astronaut_riding_a_horse_2022-08-28.png" alt="Example Stable Diffusion"></p>
<p>Demo freely available: https://huggingface.co/spaces/stabilityai/stable-diffusion</p>
</section>
<section id="transformers-vs.-rnns" class="slide level2">
<h2>Transformers vs.&nbsp;RNNs</h2>
<ul>
<li>Attention vs.&nbsp;State (Time)</li>
<li><a href="https://huggingface.co/blog/rwkv">RWKV</a></li>
</ul>

<img data-src="https://github.com/BlinkDL/RWKV-LM/blob/main/RWKV-paper.png?raw=true" class="r-stretch quarto-figure-center"><p class="caption">RWKV Picture</p></section>
<section id="encoder-vs.-decoder" class="slide level2">
<h2>Encoder vs.&nbsp;Decoder</h2>
<ul>
<li>Training vs.&nbsp;Inference<br>
</li>
<li>Retrieval-Augmented Generation (RAG)</li>
</ul>
<p><a href="https://ai.meta.com/blog/yann-lecun-ai-model-i-jepa/">Vision of LeCun</a> (Godfather, Chief AI Scientist <span class="citation" data-cites="Meta">@Meta</span>): <img data-src="https://scontent-vie1-1.xx.fbcdn.net/v/t39.2365-6/347632356_201757625702076_1813962196800732436_n.png?_nc_cat=102&amp;ccb=1-7&amp;_nc_sid=e280be&amp;_nc_ohc=8N4vxfHrutgAX_c4_ze&amp;_nc_oc=AQmBh5YdqNVruK1Mb_JgskgpAkXO2CQONeUdQQ6i5PrY4p5uBKrG05eKoNpcYB-2-oM&amp;_nc_ht=scontent-vie1-1.xx&amp;oh=00_AfCxnokxBygXUQERUDE9YYKYPiGnCoGNqGcmqdM8Xal-Fg&amp;oe=657084A0" style="width:90.0%" alt="JEPA"></p>
</section>
<section id="further-tasks-topics" class="slide level2">
<h2>Further Tasks, Topics</h2>
<ul>
<li>Content Bias like framing of messages (e.g., <a href="https://github.com/Iseratho/web23-phd-symposium/">my research focus</a>).</li>
<li>Example of solution in shared task of our group - <a href="https://arxiv.org/abs/2303.09901">mCPT</a> (1st place in zero-shot Spanish Framing Detection)</li>
<li>Question Answering is another common IR-related task tackled with Transformers.</li>
</ul>
<table>
<colgroup>
<col style="width: 63%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Computational Framing Analysis</th>
<th style="text-align: center;">mCPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img data-src="https://github.com/Iseratho/web23-phd-symposium/blob/main/Figure_1.png?raw=trueg" alt="Computational Framing Analysis"></td>
<td style="text-align: center;"><img data-src="https://github.com/socialcomplab/semeval23-mcpt/raw/main/training.png" alt="mCPT"></td>
</tr>
</tbody>
</table>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li>Transformer Conceptually</li>
<li>Text Ranking and Retrieval</li>
<li>IR Experiment Steps</li>
<li>Training and Usage of PyTorch, HuggingFace models, and other libaries</li>
<li>Variety of Tasks (Ideas for projects)</li>
</ul>
</section>
<section id="questions" class="slide level2">
<h2>Questions?</h2>
<h3 id="next-lectures">Next Lectures</h3>
<p>Bias and Fairness in Information Retrieval</p>
<ul>
<li>Relates to analysis as seen today</li>
</ul>
<p>Christmas lecture</p>
<ul>
<li>Invited lecturer</li>
</ul>

<img src="logo-RGB.png" class="slide-logo r-stretch"><div class="footer footer-default">
<p>Transformers4IR by <strong>Markus Reiter-Haas</strong> in <em>Advanced Information Retrieval(VU) (706.705)</em></p>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="air23-transformer4ir-tutorial_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,

        height: 1080,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>